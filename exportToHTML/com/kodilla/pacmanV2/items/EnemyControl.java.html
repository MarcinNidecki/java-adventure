<html>
<head>
<title>EnemyControl.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6897bb;}
.s3 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
EnemyControl.java</font>
</center></td></tr></table>
<pre><span class="s0">package </span><span class="s1">com.kodilla.pacmanV2.items</span><span class="s0">;</span>

import <span class="s1">com.kodilla.pacmanV2.PacmanAppRunner</span><span class="s0">;</span>

import <span class="s1">java.awt.*</span><span class="s0">;</span>

class <span class="s1">EnemyControl {</span>
    <span class="s0">private final </span><span class="s1">Enemy enemy</span><span class="s0">;</span>
    private final <span class="s1">Player player</span><span class="s0">;</span>
    private final <span class="s1">Collision collision = </span><span class="s0">new </span><span class="s1">Collision()</span><span class="s0">;</span>



    <span class="s1">EnemyControl(Enemy enemy</span><span class="s0">, </span><span class="s1">Player player) {</span>
        <span class="s0">this</span><span class="s1">.enemy = enemy</span><span class="s0">;</span>
        this<span class="s1">.player = player</span><span class="s0">;</span>
    <span class="s1">}</span>




    <span class="s0">void </span><span class="s1">goDown() {</span>
        enemy.y += PacmanAppRunner.speed<span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">void </span><span class="s1">goUp() {</span>
        enemy.y -= PacmanAppRunner.speed<span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">void </span><span class="s1">goRight() {</span>
        enemy.x += PacmanAppRunner.speed<span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">void </span><span class="s1">goLeft() {</span>
        enemy.x -= PacmanAppRunner.speed<span class="s0">;</span>
    <span class="s1">}</span>



    <span class="s0">boolean </span><span class="s1">checkIfIsInHome() {</span>
        <span class="s0">return </span><span class="s1">enemy.y &lt;= PacmanAppRunner.TILE_SIZE * </span><span class="s2">11 </span><span class="s1">&amp;&amp; enemy.y &gt; PacmanAppRunner.TILE_SIZE * </span><span class="s2">8 </span><span class="s1">&amp;&amp; enemy.x &gt; PacmanAppRunner.TILE_SIZE * </span><span class="s2">17 </span><span class="s1">&amp;&amp; enemy.x &lt; PacmanAppRunner.TILE_SIZE * </span><span class="s2">21</span><span class="s0">;</span>
    <span class="s1">}</span>

    <span class="s0">void </span><span class="s1">checkIfNeedToUseATeleport() {</span>
        <span class="s0">if </span><span class="s1">(enemy.x == </span><span class="s2">1480 </span><span class="s1">&amp;&amp; enemy.y == </span><span class="s2">400</span><span class="s1">) {</span>
            enemy.x = <span class="s2">0</span><span class="s0">;</span>
            <span class="s1">goRight()</span><span class="s0">;</span>

        <span class="s1">}</span>

        <span class="s0">if </span><span class="s1">(enemy.x == </span><span class="s2">0 </span><span class="s1">&amp;&amp; enemy.y == </span><span class="s2">400</span><span class="s1">) {</span>
            enemy.x = <span class="s2">1480</span><span class="s0">;</span>
            <span class="s1">goLeft()</span><span class="s0">;</span>

        <span class="s1">}</span>
    }

    <span class="s0">void </span><span class="s1">checkIfIntersectWithPlayer(</span><span class="s0">int </span><span class="s1">xx</span><span class="s0">, int </span><span class="s1">yy) {</span>
        Rectangle rectangle = <span class="s0">new </span><span class="s1">Rectangle(xx</span><span class="s0">, </span><span class="s1">yy</span><span class="s0">, </span><span class="s1">PacmanAppRunner.TILE_SIZE</span><span class="s0">, </span><span class="s1">PacmanAppRunner.TILE_SIZE)</span><span class="s0">;</span>
        if <span class="s1">(rectangle.intersects(player.getX()</span><span class="s0">, </span><span class="s1">player.getY()</span><span class="s0">, </span><span class="s2">40</span><span class="s0">, </span><span class="s2">40</span><span class="s1">)) {</span>

            <span class="s3">// if is bonus send enemy to home</span>
            <span class="s0">if </span><span class="s1">(PacmanAppRunner.bonus) {</span>
                enemy.setItsEye(<span class="s0">true</span><span class="s1">)</span><span class="s0">;</span>


            <span class="s1">} </span><span class="s0">else</span><span class="s1">{</span>

                player.backToStart()<span class="s0">;</span>
                <span class="s1">PacmanAppRunner.playerLives.removeLive()</span><span class="s0">;</span>
                <span class="s1">player.setHitByEnemy(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s1">}</span>
        }
    }

    <span class="s0">void </span><span class="s1">changeDirection() {</span>


        <span class="s3">//  when enemy have more then 2 way to choose,  check where is player then go closer</span>
        //  when enemy have only one possibilities then just change direction.
        <span class="s0">switch </span><span class="s1">(enemy.getDirection()) {</span>
            <span class="s0">case </span><span class="s1">UP:</span>
            <span class="s0">case </span><span class="s1">DOWN:</span>
                <span class="s0">if </span><span class="s1">(collision.thereIsNoCollisionOnLeft(enemy.x</span><span class="s0">,</span><span class="s1">enemy.y) &amp;&amp; collision.thereIsNoCollisionOnRight(enemy.x</span><span class="s0">,</span><span class="s1">enemy.y)) {</span>

                    <span class="s3">// if you have 2 open direction  check player position then change direction</span>
                    <span class="s0">if </span><span class="s1">(enemy.x &gt; player.getX()) {</span>
                        enemy.setDirections(Enemy.Directions.LEFT)<span class="s0">;</span>
                        <span class="s1">goLeft()</span><span class="s0">;</span>
                        break;
                    <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
                        enemy.setDirections(Enemy.Directions.RIGHT)<span class="s0">;</span>
                        <span class="s1">goRight()</span><span class="s0">;</span>
                        break;
                    <span class="s1">}</span>
                }

                <span class="s0">if </span><span class="s1">(collision.thereIsNoCollisionOnRight(enemy.x</span><span class="s0">,</span><span class="s1">enemy.y)) {</span>
                    enemy.setDirections(Enemy.Directions.RIGHT)<span class="s0">;</span>
                    <span class="s1">goRight()</span><span class="s0">;</span>
                    break;
                <span class="s1">}</span>
                <span class="s0">if </span><span class="s1">(collision.thereIsNoCollisionOnLeft(enemy.x</span><span class="s0">,</span><span class="s1">enemy.y)) {</span>
                    enemy.setDirections(Enemy.Directions.LEFT)<span class="s0">;</span>
                    <span class="s1">goLeft()</span><span class="s0">;</span>
                    break;
                <span class="s1">}</span>

            <span class="s0">case </span><span class="s1">RIGHT:</span>
            <span class="s0">case </span><span class="s1">LEFT:</span>
                <span class="s0">if </span><span class="s1">(collision.thereIsNoCollisionOnDown(enemy.x</span><span class="s0">,</span><span class="s1">enemy.y) &amp;&amp; collision.thereIsNoCollisionOnUp(enemy.x</span><span class="s0">,</span><span class="s1">enemy.y)) {</span>
                    <span class="s0">if </span><span class="s1">(enemy.y &lt; player.getY()) {</span>
                        enemy.setDirections(Enemy.Directions.DOWN)<span class="s0">;</span>
                        <span class="s1">goDown()</span><span class="s0">;</span>
                        break;
                    <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
                        enemy.setDirections(Enemy.Directions.UP)<span class="s0">;</span>
                        <span class="s1">goUp()</span><span class="s0">;</span>
                        break;
                    <span class="s1">}</span>

                }
                <span class="s0">if </span><span class="s1">(collision.thereIsNoCollisionOnDown(enemy.x</span><span class="s0">,</span><span class="s1">enemy.y)) {</span>
                    enemy.setDirections(Enemy.Directions.DOWN)<span class="s0">;</span>
                    <span class="s1">goDown()</span><span class="s0">;</span>
                    break;

                <span class="s1">}</span>
                <span class="s0">if </span><span class="s1">(collision.thereIsNoCollisionOnUp(enemy.x</span><span class="s0">,</span><span class="s1">enemy.y)) {</span>
                    enemy.setDirections(Enemy.Directions.UP)<span class="s0">;</span>
                    <span class="s1">goUp()</span><span class="s0">;</span>
                    break;
                <span class="s1">}</span>
        }
    }

    <span class="s0">private void </span><span class="s1">EscapeOnDistanceWhenLeftOrRight(</span><span class="s0">int </span><span class="s1">safeDistance) {</span>

        <span class="s3">// if enemy is in a center of tile  and can go up and  player is above enemy</span>
        <span class="s0">if </span><span class="s1">(enemy.x % PacmanAppRunner.TILE_SIZE == </span><span class="s2">0 </span><span class="s1">&amp;&amp; collision.thereIsNoCollisionOnUp(enemy.x</span><span class="s0">,</span><span class="s1">enemy.y) &amp;&amp; enemy.y &lt;= player.getY()) {</span>
            <span class="s0">if </span><span class="s1">((player.getY() - enemy.y) &lt; safeDistance) {</span>
                enemy.setDirections(Enemy.Directions.UP)<span class="s0">;</span>
                <span class="s1">goUp()</span><span class="s0">;</span>
                <span class="s1">enemy.setChangeOfDirection(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span>
                return;
            <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
                <span class="s0">if </span><span class="s1">(collision.thereIsNoCollisionOnDown(enemy.x</span><span class="s0">,</span><span class="s1">enemy.y)) {</span>
                    enemy.setDirections(Enemy.Directions.DOWN)<span class="s0">;</span>
                    <span class="s1">goDown()</span><span class="s0">;</span>
                    <span class="s1">enemy.setChangeOfDirection(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span>
                    return;
                <span class="s1">}</span>

            }
            <span class="s0">if </span><span class="s1">(enemy.x % PacmanAppRunner.TILE_SIZE == </span><span class="s2">0 </span><span class="s1">&amp;&amp; collision.thereIsNoCollisionOnDown(enemy.x</span><span class="s0">,</span><span class="s1">enemy.y) &amp;&amp; enemy.y &gt;= player.getY()) {</span>
                <span class="s0">if </span><span class="s1">((enemy.y - player.getY()) &lt; safeDistance) {</span>
                    enemy.setDirections(Enemy.Directions.DOWN)<span class="s0">;</span>
                    <span class="s1">goDown()</span><span class="s0">;</span>
                    <span class="s1">enemy.setChangeOfDirection(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span>

                <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
                    <span class="s0">if </span><span class="s1">(collision.thereIsNoCollisionOnUp(enemy.x</span><span class="s0">,</span><span class="s1">enemy.y)) {</span>
                        enemy.setDirections(Enemy.Directions.UP)<span class="s0">;</span>
                        <span class="s1">goUp()</span><span class="s0">;</span>
                        <span class="s1">enemy.setChangeOfDirection(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span>

                    <span class="s1">}</span>
                }

            }

        }
    }

    <span class="s0">private void </span><span class="s1">escapeOnDistanceWhenUpOrDown(</span><span class="s0">int </span><span class="s1">safeDistance) {</span>
        <span class="s3">//If enemy is escaping down/up and have option to turn on right</span>
        // check  if player is on left  side then escape on right
        <span class="s0">if </span><span class="s1">(enemy.y % PacmanAppRunner.TILE_SIZE == </span><span class="s2">0 </span><span class="s1">&amp;&amp; collision.thereIsNoCollisionOnRight(enemy.x</span><span class="s0">,</span><span class="s1">enemy.y) &amp;&amp; enemy.x &gt;= player.getX()) {</span>
            <span class="s3">// if distance between player and enemy is not safe then still go right</span>
            <span class="s0">if </span><span class="s1">((enemy.x - player.getX()) &lt; safeDistance) {</span>
                enemy.setDirections(Enemy.Directions.RIGHT)<span class="s0">;</span>
                <span class="s1">goRight()</span><span class="s0">;</span>
                <span class="s1">enemy.setChangeOfDirection(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span>
                return;
                <span class="s3">// if distance is safe  then go closer to player</span>
            <span class="s1">}</span>


        }
        <span class="s3">//If enemy is escaping down/up and have option to turn on left</span>
        // check  if player is on right side then escape on left
        <span class="s0">if </span><span class="s1">(enemy.y % PacmanAppRunner.TILE_SIZE == </span><span class="s2">0 </span><span class="s1">&amp;&amp; collision.thereIsNoCollisionOnLeft(enemy.x</span><span class="s0">,</span><span class="s1">enemy.y) &amp;&amp; enemy.x &lt;= player.getX()) {</span>
            <span class="s3">// if distance between player and enemy is not safe then still go right</span>
            <span class="s0">if </span><span class="s1">((enemy.x - player.getX()) &gt; safeDistance) {</span>
                enemy.setDirections(Enemy.Directions.LEFT)<span class="s0">;</span>
                <span class="s1">goLeft()</span><span class="s0">;</span>
                <span class="s1">enemy.setChangeOfDirection(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s1">}</span>

        }
    }

    <span class="s0">boolean </span><span class="s1">trackPlayerAndCheckIfIsBetterToChangeDirectionThenChangeDirection() {</span>
        enemy.setChangeOfDirection(<span class="s0">false</span><span class="s1">)</span><span class="s0">;</span>
        switch <span class="s1">(enemy.getDirection()) {</span>
            <span class="s0">case </span><span class="s1">UP:</span>
            <span class="s0">case </span><span class="s1">DOWN:</span>

                <span class="s3">// if brave and is no bonus time</span>
                <span class="s0">if </span><span class="s1">(enemy.isBrave() &amp;&amp; !PacmanAppRunner.bonus) {</span>

                    <span class="s0">if </span><span class="s1">(enemy.x &gt; player.getX() &amp;&amp; enemy.x % PacmanAppRunner.TILE_SIZE == </span><span class="s2">0 </span><span class="s1">&amp;&amp; collision.thereIsNoCollisionOnLeft(enemy.x</span><span class="s0">,</span><span class="s1">enemy.y)) {</span>
                        enemy.setDirections(Enemy.Directions.LEFT)<span class="s0">;</span>
                        <span class="s1">goLeft()</span><span class="s0">;</span>
                        <span class="s1">enemy.setChangeOfDirection(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span>
                        break;
                    <span class="s1">}</span>
                    <span class="s0">if </span><span class="s1">(enemy.x &lt; player.getX() &amp;&amp; enemy.x % PacmanAppRunner.TILE_SIZE == </span><span class="s2">0 </span><span class="s1">&amp;&amp; collision.thereIsNoCollisionOnRight(enemy.x</span><span class="s0">,</span><span class="s1">enemy.y)) {</span>
                        enemy.setDirections(Enemy.Directions.RIGHT)<span class="s0">;</span>
                        <span class="s1">goRight()</span><span class="s0">;</span>
                        <span class="s1">enemy.setChangeOfDirection(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span>
                        break;
                    <span class="s1">}</span>
                    <span class="s0">break;</span>


                <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
                    <span class="s3">// if is not brave and bonus is off then go closer and when is close to player run away</span>
                    <span class="s0">if </span><span class="s1">(!PacmanAppRunner.bonus) {</span>
                        escapeOnDistanceWhenUpOrDown(<span class="s2">160</span><span class="s1">)</span><span class="s0">;</span>
                        break;
                        <span class="s3">// is is bonus then everyone run away</span>
                    <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
                        escapeOnDistanceWhenUpOrDown(<span class="s2">1600</span><span class="s1">)</span><span class="s0">;</span>
                    <span class="s1">}</span>
                    <span class="s0">break;</span>
                <span class="s1">}</span>

            <span class="s0">case </span><span class="s1">RIGHT:</span>
            <span class="s0">case </span><span class="s1">LEFT:</span>
                <span class="s3">// if brave then get closer to player</span>
                <span class="s0">if </span><span class="s1">(enemy.isBrave()&amp;&amp; !PacmanAppRunner.bonus) {</span>
                    <span class="s0">if </span><span class="s1">(enemy.y &gt; player.getY() &amp;&amp; enemy.y % PacmanAppRunner.TILE_SIZE == </span><span class="s2">0 </span><span class="s1">&amp;&amp; collision.thereIsNoCollisionOnUp(enemy.x</span><span class="s0">,</span><span class="s1">enemy.y)) {</span>
                        enemy.setDirections(Enemy.Directions.UP)<span class="s0">;</span>
                        <span class="s1">goUp()</span><span class="s0">;</span>
                        <span class="s1">enemy.setChangeOfDirection(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span>
                        break;
                    <span class="s1">}</span>
                    <span class="s0">if </span><span class="s1">(enemy.y &lt; player.getY() &amp;&amp; enemy.y % PacmanAppRunner.TILE_SIZE == </span><span class="s2">0 </span><span class="s1">&amp;&amp; collision.thereIsNoCollisionOnDown(enemy.x</span><span class="s0">,</span><span class="s1">enemy.y)) {</span>
                        enemy.setDirections(Enemy.Directions.DOWN)<span class="s0">;</span>
                        <span class="s1">goDown()</span><span class="s0">;</span>

                        <span class="s1">enemy.setChangeOfDirection(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span>
                        break;
                    <span class="s1">}</span>
                    <span class="s0">break;</span>

                    <span class="s3">// if is not brave  then when is close to player run away</span>
                <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
                    <span class="s0">if </span><span class="s1">(!PacmanAppRunner.bonus) {</span>
                        <span class="s3">// is bonus if OFF but enemy is not brave</span>
                        <span class="s1">EscapeOnDistanceWhenLeftOrRight(</span><span class="s2">160</span><span class="s1">)</span><span class="s0">;</span>
                        break;
                        <span class="s3">// when bonus is on</span>
                    <span class="s1">} </span><span class="s0">else </span><span class="s1">{</span>
                        EscapeOnDistanceWhenLeftOrRight(<span class="s2">1600</span><span class="s1">)</span><span class="s0">;</span>
                    <span class="s1">}</span>


                    <span class="s0">break;</span>
                <span class="s1">}</span>
        }
        <span class="s0">return </span><span class="s1">enemy.isChangeOfDirection()</span><span class="s0">;</span>
    <span class="s1">}</span>

}</pre>
</body>
</html>